let eventify=a=>{a.events={},a.on=function(b,c){"object"!=typeof a.events[b]&&(a.events[b]=[]),a.events[b].push(c)},a.removeListener=function(b,d){let c;"object"==typeof a.events[b]&&(c=a.events[b].indexOf(d))> -1&&a.events[b].splice(c,1)},a.emit=function(c){var b,d,e,f=[].slice.call(arguments,1);if("object"==typeof a.events[c])for(b=0,e=(d=a.events[c].slice()).length;b<e;b++)d[b].apply(a,f)},a.once=function(b,c){a.on(b,function d(){a.removeListener(b,d),c.apply(a,arguments)})}};export const id=()=>Math.random().toString(36).substring(2,9),getRandomName=()=>{let a="James;Robert;John;Michael;David;William;Richard;Joseph;Thomas;Charles;Christopher;Daniel;Matthew;Anthony;Mark;Donald;Steven;Paul;Andrew;Joshua;Kenneth;Kevin;Brian;George;Timothy;Ronald;Edward;Jason;Jeffrey;Ryan;Jacob;Gary;Nicholas;Eric;Jonathan;Stephen;Larry;Justin;Scott;Brandon;Benjamin;Samuel;Gregory;Alexander;Frank;Patrick;Raymond;Jack;Dennis;Jerry;Tyler;Aaron;Jose;Adam;Nathan;Henry;Douglas;Zachary;Peter;Kyle;Ethan;Walter;Noah;Jeremy;Christian;Keith;Roger;Terry;Gerald;Harold;Sean;Austin;Carl;Arthur;Lawrence;Dylan;Jesse;Jordan;Bryan;Billy;Joe;Bruce;Gabriel;Logan;Albert;Willie;Alan;Juan;Wayne;Elijah;Randy;Roy;Vincent;Ralph;Eugene;Russell;Bobby;Mason;Philip;Louis".split(";");return a[Math.floor(Math.random()*a.length)]},defined=a=>null!=a,workingWorld={};export class World{constructor(a={canvas:null,doc:document,G:{x:0,y:.001},pattern:"color",background:"#000",color:"#fff",size:{width:window.innerWidth,height:window.innerHeight},hasLimits:!0,tag:"map",border:{width:1,background:"#000",pattern:"color"},sprites:{},onmousemove:null,onclick:null,onmouseup:null,rotation:0,paused:!1,createWorld:!0}){if(eventify(this),this.canvas=a.canvas||null,this.createWorld=!defined(a.createWorld)||a.createWorld,this.doc=a.doc||document,this.G=a.G||{x:0,y:.001},this.pattern=a.pattern||"color",this.background=a.background||"#000",this.color=a.color||"#fff",this.size=a.size||{width:window.innerWidth,height:window.innerHeight},this.hasLimits=void 0===this.hasLimits||this.hasLimits,this.tag=this.tag||"map",this.border=a.border||{width:0,background:"#000",pattern:"color"},this.sprites=this.sprites||{},this.G=a.G||{x:0,y:.001},this.Objects=[],this.keys={},this.set=(a,b)=>{this[a]=b},this.responsive=void 0===a.responsive||a.responsive,this.paused=void 0!==a.paused&&a.paused,this.rotation=void 0!==a.rotation?a.rotation:0,this.borderY={type:"rectangle",pattern:this.border.pattern,background:this.border.background,width:this.border.width,height:this.height,x:0,y:0,tag:"border",border:this.border},this.borderX={type:"rectangle",pattern:this.border.pattern,background:this.border.background,width:this.width,height:this.border.width,x:0,y:0,tag:"border",border:this.border},this.borderYW={type:"rectangle",pattern:this.border.pattern,background:this.border.background,width:this.border.width,height:this.height,x:this.width-this.border.width,y:0,tag:"border",border:this.border},this.borderXW={type:"rectangle",pattern:this.border.pattern,background:this.border.background,width:this.width,height:this.border.width,x:0,y:this.height-this.border.width,tag:"border",name:"borderXW",border:this.border},!0===this.createWorld){if(this.canvas||(this.canvas=this.doc.createElement("canvas"),this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.doc.body.appendChild(this.canvas)),this.responsive){var b=()=>{this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height};window.addEventListener("resize",b)}this.hasLimits&&[this.borderX,this.borderY,this.borderXW,this.borderYW].forEach(a=>{this.register(new Shape({...a,physics:!1}))}),this.onLoad=a=>window.addEventListener("load",a),this.doc.addEventListener("keydown",a=>{this.keys[a.key]=!0}),this.doc.addEventListener("keyup",a=>{this.keys[a.key]=!1}),this.tag=this.tag||"map",Object.keys(this.sprites).forEach((a,b)=>{this.sprites[a]={},this.sprites[a].image=new Image,this.sprites[a].image.src=this.sprites[a].src,this.sprites[a].image.decode().then(()=>{this.sprites[a].width=this.sprites[a].image.width,this.sprites[a].height=this.sprites[a].image.height})}),this.mouse={x:0,y:0},this.canvas.addEventListener("mousemove",a=>{this.mouse.x=a.offsetX,this.mouse.y=a.offsetY}),this.mousedown=a.mousedown||(()=>{}),this.mouseup=a.mouseup||(()=>{}),this.mousemove=a.mousemove||(()=>{}),this.canvas.addEventListener("mousedown",a=>this.mousedown(a)),this.canvas.addEventListener("mouseup",a=>this.mouseup(a)),this.canvas.addEventListener("mousemove",a=>this.mousemove(a)),this.emit("load"),workingWorld=this,this.ctx=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height}}key={isPressed:a=>this.keys[a]};destroy(){this.canvas.remove(),this.Objects=[]}register(a){this.Objects.push(a)}unregister(a){this.Objects.forEach((b,c)=>b.id===a.id&&this.Objects.splice(c,1))}center(a,b=!1){a.x=this.canvas.width/2,a.y=this.canvas.height/2,b&&(a.velocity={x:0,y:0})}centerX(a,b=!1){a.x=this.canvas.width/2,b&&(a.velocity={x:0,y:0})}centerY(a,b=!1){a.y=this.canvas.height/2,b&&(a.velocity={x:0,y:0})}draw(a){switch(a.type=a.type||"rectangle",a.background=a.background||"#000",a.pattern=a.pattern||"color",a.radius=a.radius||void 0,a.width=a.radius||2*a.width||50,a.height=a.radius||2*a.height||50,a.x=void 0!==a.x?a.x:this.canvas.width/2,a.y=void 0!==a.y?a.y:this.canvas.height/2,a.rotation=void 0!==a.rotation?a.rotation:0,a.x1=void 0!==a.x1?a.x1:a.x,a.y1=void 0!==a.y1?a.y1:a.y,a.x2=void 0!==a.x2?a.x2:a.x,a.y2=void 0!==a.y2?a.y2:a.y,this.ctx.save(),this.ctx.translate(a.x,a.y),this.ctx.rotate(a.rotation),a.type){case"rectangle":switch(a.pattern){case"color":this.ctx.fillStyle=a.background,this.ctx.fillRect(a.x,a.y,a.width,a.height);break;case"image":this.ctx.drawImage(a.image,-a.width/2,-a.height/2,a.width,a.height)}break;case"circle":case"dot":switch(a.pattern){case"color":this.ctx.fillStyle=a.background,this.ctx.beginPath(),this.ctx.arc(0,0,a.radius,0,2*Math.PI),this.ctx.fill();break;case"image":this.ctx.drawImage(a.image,-a.radius,-a.radius,2*a.radius,2*a.radius)}break;case"line":this.ctx.strokeStyle=a.background,this.ctx.lineWidth=a.width,this.ctx.beginPath(),this.ctx.moveTo(a.x1-workingWorld.width/2,a.y1-workingWorld.height/2),this.ctx.lineTo(a.x2-workingWorld.width/2,a.y2-workingWorld.height/2),this.ctx.stroke()}this.ctx.restore()}collision(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y}isTouchingLimits(a){return a.x+a.width>0&&a.x<workingWorld.width&&a.y+a.height>0&&a.y<workingWorld.height}getElementsByTagName(a){return this.Objects.filter(b=>b.tag===a)}getElementByTagName(a){return this.Objects.find(b=>b.tag===a)}getElementsByName(a){return this.Objects.filter(b=>b.name===a)}getElementByName(a){return this.Objects.find(b=>b.name===a)}getElementsByType(a){return this.Objects.filter(b=>b.type===a)}preventCollision(a,b){if("object"==typeof b&&b instanceof Array)b.forEach(b=>a.isBody&&b.isBody&&this.preventCollision(a,b));else if(a.id!==b.id&&this.collision(a,b)){switch("border"===a.tag||"border"===b.tag||a.CCHas(b)||(a.onCollision(b,a),b.onCollision(a,b),a.collideWith(b),b.collideWith(a)),a.cacheDirection){case"down":a.y+a.height>b.y&&(a.y=b.y-a.height,a.velocity.x=a.velocity.x*a.friction);break;case"up":a.y<b.y+b.height&&(a.y=b.y+b.height,a.velocity.x=a.velocity.x*a.friction);break;case"left":a.x<b.x+b.width&&(a.x=b.x+b.width);break;case"right":a.x+a.width>b.x&&(a.x=b.x-a.width)}if(a.physics)switch(a.cacheDirection){case"left":case"right":var c=~~(-a.velocity.x*a.rebound);a.velocity.x=c;break;case"up":case"down":var c=~~(-a.velocity.y*a.rebound);a.velocity.y=c,a.cacheDirection=a.velocity.y<0?"down":"up",0===c&&(a.cacheDirection="down")}}else!this.collision(a,b)&&b.CCHas(a)&&(a.finishCollideWith(b),b.finishCollideWith(a),a.onFinishCollision(b,a),b.onFinishCollision(a,b))}update(a=null){if(!this.paused){switch(this.ctx.clearRect(0,0,this.width,this.height),this.pattern){case"color":this.draw({pattern:"color",background:this.background,x:0,y:0,width:this.width,height:this.height});break;case"image":this.draw({pattern:"image",image:this.background.image,x:0,y:0,width:this.width,height:this.height})}a&&a(),this.Objects=this.Objects.sort((a,b)=>a.zIndex-b.zIndex),this.Objects=this.Objects.sort((a,b)=>"wall"===a.tag?-1:1),this.Objects.forEach(a=>{if(a.physics){if(this.getElementsByType("border").some(b=>this.collision(a,b)))switch(a.velocity.y=0,a.velocity.x=0,a.cacheDirection){case"down":a.cacheDirection="up";break;case"up":break;case"left":a.cacheDirection="right";break;case"right":a.cacheDirection="left"}else a.velocity.x+=this.G.x,a.velocity.y+=this.G.y;a.x+=a.velocity.x,a.y+=a.velocity.y,a.cacheDirection=a.velocity.x<0?"right":"left",a.cacheDirection=a.velocity.y<0?"up":"down",workingWorld.preventCollision(a,workingWorld.Objects)}a.draw()})}}pause(){this.paused=!0}resume(){this.paused=!1}getCursorPosition(){return{x:this.mouse.x,y:this.mouse.y}}generateMap(a,c){let b={};return a.forEach((d,e)=>{d.split("").forEach((f,g)=>{let h=d.length;c[f]&&(b[f]||(b[f]=[]),b[f].push(c[f]({mapWidth:workingWorld.width,mapHeight:workingWorld.height,x:g*(workingWorld.width/h),y:e*(workingWorld.height/a.length),width:workingWorld.width/h,height:workingWorld.height/a.length,Cindex:g,Lindex:e})))})}),b}HoveredObjects(){return workingWorld.Objects.filter(a=>a.x<this.mouse.x&&a.x+a.width>this.mouse.x&&a.y<this.mouse.y&&a.y+a.height>this.mouse.y)}getEmptySpace(b){let c=[],a=[];this.Objects.forEach(b=>{"border"!==b.tag&&"emptySpace"!==b.tag&&"player"!==b.tag&&a.push({x:b.x,y:b.y,width:b.width,height:b.height})}),b&&a.forEach(c=>{c.x===b.x&&c.y===b.y&&a.splice(a.indexOf(c),1)}),a.forEach(a=>{let b=a.x,d=a.y,i=a.width,j=a.height,e=b,f=b+i,g=d,h=d+j;c.push({start:e,end:f}),c.push({start:e,end:f}),c.push({start:g,end:h}),c.push({start:g,end:h})}),c.sort((a,b)=>a.start-b.start)}oncePressed(a,b){window.addEventListener("keyup",c=>{c.key===a&&b()})}}export class Shape{constructor(a={type:"rectangle",x:0,y:0,width:10,height:10,zIndex:0,isBody:!0,pattern:"color",background:"",rotation:0,name:getRandomName(),tag:"unknown",onCollision:(b,a)=>console.log("Collided with:",a.name),onFinishCollision:(b,a)=>console.log("Finished colliding with:",a.name),physics:!1,rebound:.9,friction:.5,id:id(),speed:3,velocity:{x:0,y:0},border:{background:"blue",width:2},animate:!0,flip:[]},b=!1){if(!workingWorld)throw new Error("BrainError: No world is initialized!");return eventify(this),this.type=a.type||"rectangle",this.zIndex=defined(a.zIndex)?a.zIndex:0,this.flip=defined(a.flip)?a.flip:[],this.background=a.color||"black",this.x=a.x||0,this.y=a.y||0,this.radius=a.radius,void 0!==this.radius?(this.width=this.radius,this.height=this.radius):(this.width=a.width||10,this.height=a.height||10),this.isBody=void 0===a.isBody||a.isBody,this.animate=void 0===a.animate||a.animate,this.pattern=a.pattern||"color",this.background=a.background||"",this.rotation=a.rotation||0,this.name=a.name||getRandomName(),this.tag=a.tag||"unknown",this.onCollision=a.onCollision||(()=>{}),this.onFinishCollision=a.onFinishCollision||(()=>{}),this.collitionObjects=[],this.physics=void 0!==a.physics&&a.physics,this.rebound=void 0!==a.rebound?a.rebound:.9,this.friction=void 0!==a.friction?a.friction:.5,this.border=void 0!==a.border?a.border:{background:"transparent",width:0},this.id=id(),this.cacheDirection="up",this.speed=a.speed||3,this.velocity=a.velocity||{x:0,y:0},workingWorld.register&&!b&&workingWorld.register(this),this}collideWith(a){this.collitionObjects.push(a)}finishCollideWith(a){this.collitionObjects.forEach((b,c)=>b.id===a.id&&this.collitionObjects.splice(c,1))}rotate(a){this.rotation+=a}setRotation(a){this.rotation=a}draw(){switch(this.flip.includes("x")&&(workingWorld.ctx.scale(-1,1),workingWorld.ctx.translate(-this.width,0)),this.flip.includes("y")&&(workingWorld.ctx.scale(1,-1),workingWorld.ctx.translate(0,-this.height)),this.type){case"rectangle":if("color"===this.pattern){var a=workingWorld.ctx;a.save(),a.translate(this.x,this.y),a.rotate(this.rotation*Math.PI/180),a.translate(-this.x-this.width/2,-this.y-this.height/2),a.fillStyle=this.background,a.fillRect(this.x,this.y,this.width,this.height),a.restore(),a.setTransform(1,0,0,1,0,0)}if("gradient"===this.pattern){if(!this.background.gradientSettings)throw new Error("ArgumentError: No gradient settings found!");if(!this.background.gradientSettings.startColor)throw new Error("ArgumentError: No start color found!");if(!this.background.gradientSettings.endColor)throw new Error("ArgumentError: No end color found!");let b=workingWorld.ctx.createGradient(this.background.gradientSettings);b.addColorStop(0,this.background.gradientStart),b.addColorStop(1,this.background.gradientEnd)}if("image"===this.pattern){if(!this.background.image)throw new Error("ArgumentError: No image found!");var a=workingWorld.ctx;a.save(),a.translate(this.x,this.y),a.rotate(this.rotation*Math.PI/180),a.translate(-this.x-this.width/2,-this.y-this.height/2),a.drawImage(this.background.image,-this.width,-this.height,this.width,this.height),a.restore(),workingWorld.ctx.setTransform(1,0,0,1,0,0)}break;case"circle":workingWorld.ctx.beginPath(),workingWorld.ctx.arc(this.x+this.width/2,this.y+this.height/2,this.width/2,0,2*Math.PI),workingWorld.ctx.fillStyle=this.pattern||this.background,workingWorld.ctx.fill();break;case"line":workingWorld.ctx.beginPath(),workingWorld.ctx.moveTo(this.x,this.y),workingWorld.ctx.lineTo(this.x+this.width,this.y+this.height),workingWorld.ctx.strokeStyle=this.pattern||this.background,workingWorld.ctx.stroke();break;case"image":workingWorld.ctx.drawImage(this.image,this.x,this.y,this.width,this.height)}if(this.border){workingWorld.ctx.strokeStyle=this.border.background;var c=workingWorld.ctx.lineWidth;workingWorld.ctx.lineWidth=this.border.width,workingWorld.ctx.strokeRect(this.x,this.y,this.width,this.height),workingWorld.ctx.lineWidth=c}workingWorld.ctx.setTransform(1,0,0,1,0,0)}remove(){workingWorld.unregister(this)}result(){return this}isOutOfMap(){return this.x<0||this.x>workingWorld.width||this.y<0||this.y>workingWorld.height}isOutOfRange(a){return this.x<a.start||this.x>a.end||this.y<a.start||this.y>a.end}get(a){return this[a]}set(a,b){return this[a]=b,this}move(b,c=null,d=!1){this.cacheDirection=b;var a=null!==c?c:this.speed;switch(b){case"up":this.y-=a;break;case"down":this.y+=a;break;case"left":this.x-=a;break;case"right":this.x+=a}workingWorld.preventCollision(this,workingWorld.Objects)}follow(b){let d=b.x-this.x,e=b.y-this.y,c=Math.atan2(e,d);this.velocity.x=Math.cos(c)*this.speed,this.velocity.y=Math.sin(c)*this.speed;let a="";this.velocity.x>0&&(a+=" right"),this.velocity.x<0&&(a+=" left"),this.velocity.y>0&&(a+=" down"),this.velocity.y<0&&(a+=" up"),(a=a.substring(1)).split(" ").forEach(a=>this.move(a)),workingWorld.preventCollision(this,workingWorld.Objects)}onCollide(a){return this.onCollision=a,this}isCollidingWith(a){return workingWorld.collision(this,a)}CCHas(b){var a=!1;return this.collitionObjects.forEach(c=>{c.id===b.id&&(a=!0)}),a}jump(a){this.velocity.y=-a}}export class Animation{constructor(b,c=100,...a){if(!b)throw new Error("ArgumentError: No target found!");if(!a||!a.length)throw new Error("ArgumentError: No frames found!");this.target=b,this.speed=c||100,this.frames=a,this.currentFrame=0,this.isPlaying=!0,setInterval(()=>{if(this.isPlaying){if(this.currentFrame++,this.currentFrame>=this.frames.length&&(this.currentFrame=0),"image"!==b.pattern)throw new Error("ArgumentError: Target must be an image!");b.background.image=this.frames[this.currentFrame]}},this.speed)}start(){this.isPlaying=!0}stop(){this.isPlaying=!1}}export function Text(a){switch(a.text=a.text||"",a.background=a.background||"white",a.font=a.font||"Arial",a.size=a.size||"20px",a.x=a.x||0,a.y=a.y||0,a.type=a.type||"fill",a.y=a.y+a.size.split("px")[0]/2,workingWorld.ctx.font=a.size+" "+a.font,a.type){case"fill":workingWorld.ctx.fillStyle=a.background,workingWorld.ctx.fillText(a.text,a.x,a.y);break;case"stroke":workingWorld.ctx.strokeStyle=a.background,workingWorld.ctx.strokeText(a.text,a.x,a.y)}}export function LoadImage(a){return new Promise((c,d)=>{let b=new Image;b.onload=()=>c(b),b.src=a})}export function LoadAudio(a){return new Promise((c,d)=>{let b=new Audio;b.src=a,c(b)})}export async function spritesBETA(a){for(let b in a)workingWorld.sprites[b]=await image(a[b])}
